!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e=e||self).parentFramy={})}(this,function(e){"use strict";function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function c(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)}return n}var i="@evt";function a(e){var t=e.type,n=e.data,r=void 0===n?null:n,i=e.name;return JSON.stringify({type:t,payload:{data:r,name:i}})}var o=function(){function u(e){var t,n=e.id,r=e.url,i=e.dimensions,a=void 0===i?{}:i,o=e.props,s=void 0===o?{}:o;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u),this.API={},this.id=n,this.url=r,this.props=s,this.listeners={},this.apiListeners={},this.listen(),this.dimensions={height:a.height||"auto",width:a.width||"auto"};try{t=function(e){var t=JSON.stringify(e),n=btoa(t);return"?props=".concat(encodeURIComponent(n))}(function(i){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?c(a,!0).forEach(function(e){var t,n,r;t=i,r=a[n=e],n in t?Object.defineProperty(t,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[n]=r}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(a)):c(a).forEach(function(e){Object.defineProperty(i,e,Object.getOwnPropertyDescriptor(a,e))})}return i}({},s,{id:n}))}catch(e){throw new Error("Props cannot contain circular data")}this.frame=document.createElement("iframe"),this.frame.setAttribute("src","".concat(r).concat(t)),this.frame.setAttribute("width",a.width),this.frame.setAttribute("height",a.height)}return function(e,t,n){t&&r(e.prototype,t),n&&r(e,n)}(u,[{key:"render",value:function(e){var t=document.querySelector(e);if(!t)throw new Error("Parent element does not exist");return t.appendChild(this.frame),this}},{key:"on",value:function(e,t){if("string"!=typeof e||"function"!=typeof t)throw new Error("Event name should be string; listener should function");this.listeners[e]||(this.listeners[e]=[]),this.listeners[e].push(t)}},{key:"emit",value:function(e,t){var n=a({type:i,data:t,name:e});this.sendMessage(n)}},{key:"sendMessage",value:function(e){this.frame.contentWindow.postMessage(e,"*")}},{key:"registerApi",value:function(e){var r=this,i=e.name;this.API[i]=function(e){var t=new Promise(function(e){r.apiListeners[i]=e}),n=a({type:"@c-a",name:i,data:e});return r.sendMessage(n),t}}},{key:"callEvent",value:function(e){var t=e.name,n=e.data;this.listeners[t]&&this.listeners[t].forEach(function(e){return e(n)})}},{key:"callApi",value:function(e){var t=e.name,n=e.data;this.apiListeners[t]&&(this.apiListeners[t](n),this.apiListeners[t]=void 0)}},{key:"listen",value:function(){var n=this;window.addEventListener("message",function(e){var t=function(e){var t=JSON.parse(e),n=t.type,r=t.payload,i=(r=void 0===r?{}:r).id,a=r.data,o=void 0===a?null:a;return{id:i,type:n,name:r.name,data:o}}(e.data);if(t.id===n.id)return t.type===i?n.callEvent({name:t.name,data:t.data}):"@r-a"===t.type?n.registerApi({name:t.name}):"@c-a-r"===t.type?n.callApi({name:t.name,data:t.data}):void 0})}}]),u}();e.create=function(e){var t=e.dimensions,n=e.id,r=e.props,i=e.url;return new o({dimensions:t,id:n,props:r,url:i})},Object.defineProperty(e,"__esModule",{value:!0})});
