!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports):"function"==typeof define&&define.amd?define(["exports"],n):n((e=e||self).childFramy={})}(this,function(e){"use strict";function a(e,n){for(var t=0;t<n.length;t++){var i=n[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function r(e,n){if(null==e)return{};var t,i,a=function(e,n){if(null==e)return{};var t,i,a={},r=Object.keys(e);for(i=0;i<r.length;i++)t=r[i],0<=n.indexOf(t)||(a[t]=e[t]);return a}(e,n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(i=0;i<r.length;i++)t=r[i],0<=n.indexOf(t)||Object.prototype.propertyIsEnumerable.call(e,t)&&(a[t]=e[t])}return a}var s="@evt",o="props";function d(e){var n=e.id,t=e.type,i=e.data,a=void 0===i?null:i,r=e.name;return JSON.stringify({type:t,payload:{id:n,data:a,name:r}})}var n=function(){function i(){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,i);var e=function(){for(var e=window.location.search.substring(1).split("&"),n=0;n<e.length;n++){var t=e[n].split("=");if(decodeURIComponent(t[0])==o)return JSON.parse(atob(decodeURIComponent(t[1])))}throw new Error("Props are transferred incorrectly and cannot be parsed")}(),n=e.id,t=r(e,["id"]);this.props=t,this.id=n,this.api={},this.apiListeners={},this.listeners={},this.listen()}return function(e,n,t){n&&a(e.prototype,n),t&&a(e,t)}(i,[{key:"on",value:function(e,n){if("string"!=typeof e||"function"!=typeof n)throw new Error("Event name should be string; listener should function");this.listeners[e]||(this.listeners[e]=[]),this.listeners[e].push(n)}},{key:"emit",value:function(e,n){var t=d({id:this.id,type:s,data:n,name:e});this.sendMessage(t)}},{key:"sendMessage",value:function(e){window.parent.postMessage(e,"*")}},{key:"listen",value:function(){var t=this;window.addEventListener("message",function(e){var n=function(e){var n=JSON.parse(e),t=n.type,i=n.payload,a=(i=void 0===i?{}:i).data,r=void 0===a?null:a;return{type:t,name:i.name,data:r}}(e.data);return n.type===s?t.callEvent({name:n.name,data:n.data}):"@c-a"===n.type?t.callApi({name:n.name,data:n.data}):void 0})}},{key:"callApi",value:function(e){var n=e.name,t=e.data;if(this.apiListeners[n]){var i=this.apiListeners[n](t),a=d({id:this.id,type:"@c-a-r",data:i,name:n});this.sendMessage(a)}}},{key:"callEvent",value:function(e){var n=e.name,t=e.data;this.listeners[n]&&this.listeners[n].forEach(function(e){return e(t)})}},{key:"exposeAPI",value:function(e,n){var t=d({id:this.id,type:"@r-a",name:e});this.sendMessage(t),this.apiListeners[e]=n}}]),i}();e.init=function(){return window.iframy=new n,window.iframy},e.instance=function(){return window.iframy},e.isChild=function(){return window.parent!==window},e.isInitialized=function(){return window.iframy instanceof n},Object.defineProperty(e,"__esModule",{value:!0})});
