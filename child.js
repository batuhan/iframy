!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e=e||self).iframy={})}(this,(function(e){"use strict";function t(e,t,r,n,i,o,a){try{var s=e[o](a),u=s.value}catch(e){return void r(e)}s.done?t(u):Promise.resolve(u).then(n,i)}function r(e){return function(){var r=this,n=arguments;return new Promise((function(i,o){var a=e.apply(r,n);function s(e){t(a,i,o,s,u,"next",e)}function u(e){t(a,i,o,s,u,"throw",e)}s(void 0)}))}}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function o(e,t,r){return t&&i(e.prototype,t),r&&i(e,r),e}function a(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var s=function(e){var t=Object.prototype,r=t.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},i=n.iterator||"@@iterator",o=n.asyncIterator||"@@asyncIterator",a=n.toStringTag||"@@toStringTag";function s(e,t,r,n){var i=t&&t.prototype instanceof l?t:l,o=Object.create(i.prototype),a=new x(n||[]);return o._invoke=function(e,t,r){var n="suspendedStart";return function(i,o){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===i)throw o;return E()}for(r.method=i,r.arg=o;;){var a=r.delegate;if(a){var s=w(a,r);if(s){if(s===c)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var l=u(e,t,r);if("normal"===l.type){if(n=r.done?"completed":"suspendedYield",l.arg===c)continue;return{value:l.arg,done:r.done}}"throw"===l.type&&(n="completed",r.method="throw",r.arg=l.arg)}}}(e,r,a),o}function u(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}e.wrap=s;var c={};function l(){}function h(){}function f(){}var d={};d[i]=function(){return this};var p=Object.getPrototypeOf,v=p&&p(p(k([])));v&&v!==t&&r.call(v,i)&&(d=v);var y=f.prototype=l.prototype=Object.create(d);function m(e){["next","throw","return"].forEach((function(t){e[t]=function(e){return this._invoke(t,e)}}))}function g(e){var t;this._invoke=function(n,i){function o(){return new Promise((function(t,o){!function t(n,i,o,a){var s=u(e[n],e,i);if("throw"!==s.type){var c=s.arg,l=c.value;return l&&"object"==typeof l&&r.call(l,"__await")?Promise.resolve(l.__await).then((function(e){t("next",e,o,a)}),(function(e){t("throw",e,o,a)})):Promise.resolve(l).then((function(e){c.value=e,o(c)}),(function(e){return t("throw",e,o,a)}))}a(s.arg)}(n,i,t,o)}))}return t=t?t.then(o,o):o()}}function w(e,t){var r=e.iterator[t.method];if(void 0===r){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,w(e,t),"throw"===t.method))return c;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return c}var n=u(r,e.iterator,t.arg);if("throw"===n.type)return t.method="throw",t.arg=n.arg,t.delegate=null,c;var i=n.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,c):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,c)}function b(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function L(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function x(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(b,this),this.reset(!0)}function k(e){if(e){var t=e[i];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,o=function t(){for(;++n<e.length;)if(r.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return o.next=o}}return{next:E}}function E(){return{value:void 0,done:!0}}return h.prototype=y.constructor=f,f.constructor=h,f[a]=h.displayName="GeneratorFunction",e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===h||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,f):(e.__proto__=f,a in e||(e[a]="GeneratorFunction")),e.prototype=Object.create(y),e},e.awrap=function(e){return{__await:e}},m(g.prototype),g.prototype[o]=function(){return this},e.AsyncIterator=g,e.async=function(t,r,n,i){var o=new g(s(t,r,n,i));return e.isGeneratorFunction(r)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},m(y),y[a]="Generator",y[i]=function(){return this},y.toString=function(){return"[object Generator]"},e.keys=function(e){var t=[];for(var r in e)t.push(r);return t.reverse(),function r(){for(;t.length;){var n=t.pop();if(n in e)return r.value=n,r.done=!1,r}return r.done=!0,r}},e.values=k,x.prototype={constructor:x,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(L),!e)for(var t in this)"t"===t.charAt(0)&&r.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(r,n){return a.type="throw",a.arg=e,t.next=r,n&&(t.method="next",t.arg=void 0),!!n}for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],a=o.completion;if("root"===o.tryLoc)return n("end");if(o.tryLoc<=this.prev){var s=r.call(o,"catchLoc"),u=r.call(o,"finallyLoc");if(s&&u){if(this.prev<o.catchLoc)return n(o.catchLoc,!0);if(this.prev<o.finallyLoc)return n(o.finallyLoc)}else if(s){if(this.prev<o.catchLoc)return n(o.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return n(o.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,c):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),c},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),L(r),c}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var i=n.arg;L(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:k(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),c}},e}("object"==typeof module?module.exports:{});try{regeneratorRuntime=s}catch(e){Function("r","regeneratorRuntime = r")(s)}var u=function(e){var t=e.id,r=e.type,n=e.data,i=void 0===n?null:n,o=e.meta,a=void 0===o?null:o,s=e.name,u=void 0===s?null:s,c=e.uid,l=void 0===c?null:c;return JSON.stringify({id:t,data:i,meta:a,name:u,type:r,uid:l})},c=function(){function e(){n(this,e),a(this,"listeners",{})}return o(e,[{key:"on",value:function(e,t){this.listeners[e]||(this.listeners[e]=[]),this.listeners[e].push(t)}},{key:"once",value:function(e,t){var r=this;this.listeners[e]||(this.listeners[e]=[]);this.listeners[e].push((function n(i){t(i);for(var o=0;o<r.listeners[e].length;o++)r.listeners[e][o]===n&&r.listeners[e].splice(o,1)}))}},{key:"off",value:function(e,t){if(this.listeners[e])for(var r=0;r<this.listeners[e].length;r++)this.listeners[e][r]===t&&this.listeners[e].splice(r,1)}},{key:"offAll",value:function(e){this.listeners[e]=[]}},{key:"emit",value:function(e,t){this.listeners[e]&&this.listeners[e].forEach((function(e){return e(t)}))}}]),e}(),l=function(){var e=new URLSearchParams(window.location.search).get("@if-uid");if(!e)throw new Error("Please recheck configuration. Child iframe should be opened automatically, no query params should be changed / removed manually");return e},h=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};n(this,e),a(this,"listenersBus",new c),a(this,"firstMessageData",{isReceived:!1,id:""}),a(this,"api",void 0),a(this,"uid",void 0),a(this,"props",void 0),a(this,"on",this.addListener.bind(this)),a(this,"once",this.addListenerOnce.bind(this)),a(this,"off",this.removeListener.bind(this)),a(this,"offAll",this.removeAllListeners.bind(this)),this.globalListener=this.globalListener.bind(this),this.uid=l(),this.api=t.api||{},window.addEventListener("message",this.globalListener)}var t,i,s;return o(e,[{key:"globalListener",value:(s=r(regeneratorRuntime.mark((function e(t){var r,n,i,o,a,s,u,c,l;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.prev=0,h=t.data,f=void 0,f=JSON.parse(h),r={id:f.id,data:f.data,meta:f.meta,name:f.name,type:f.type,uid:f.uid},e.next=8;break;case 4:return e.prev=4,e.t0=e.catch(0),console.warn("Message received, but was not parsed"),e.abrupt("return");case 8:if(i=(n=r).id,o=n.data,a=n.name,"@if-init-req"!==(s=n.type)){e.next=14;break}return u=o.props,this.props=u,this.firstMessageData={id:i,isReceived:!0},e.abrupt("return");case 14:if("@if-p-to-ch"===s&&this.listenersBus.emit(a,o),"@if-api-req"!==s){e.next=27;break}return e.prev=16,e.next=19,this.api[a](o);case 19:c=e.sent,this.sendMessage({id:i,data:c,name:a,type:"@if-api-res"}),e.next=27;break;case 23:e.prev=23,e.t1=e.catch(16),l=e.t1.message,this.sendMessage({id:i,meta:{error:"regular-error",message:l},name:a,type:"@if-api-res"});case 27:case"end":return e.stop()}var h,f}),e,this,[[0,4],[16,23]])}))),function(e){return s.apply(this,arguments)})},{key:"sendMessage",value:function(e){var t,r=e.id,n=e.data,i=e.name,o=e.type;try{t=u({id:r,data:n,name:i,type:o,uid:this.uid})}catch(e){console.warn("Message was not serialized successfully, please check the data you passed"),t=u({id:r,meta:{errorType:"coerce-error"},name:i,type:o,uid:this.uid})}window.parent.postMessage(t,"*")}},{key:"initialize",value:(i=r(regeneratorRuntime.mark((function e(){var t,r=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=function e(t){requestAnimationFrame((function(){if(r.firstMessageData.isReceived)return t();e(t)}))},e.next=3,new Promise((function(e){return t(e)}));case 3:this.sendMessage({data:Object.keys(this.api),id:this.firstMessageData.id,type:"@if-init-res"});case 4:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"addListener",value:function(e,t){this.listenersBus.on(e,t)}},{key:"addListenerOnce",value:function(e,t){this.listenersBus.once(e,t)}},{key:"removeListener",value:function(e,t){this.listenersBus.off(e,t)}},{key:"removeAllListeners",value:function(e){this.listenersBus.offAll(e)}},{key:"emit",value:function(e,t){this.sendMessage({data:t,name:e,type:"@if-ch-to-p",uid:this.uid})}}],[{key:"create",value:(t=r(regeneratorRuntime.mark((function t(r){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=new e(r),t.next=3,n.initialize();case 3:return t.abrupt("return",n);case 4:case"end":return t.stop()}}),t)}))),function(e){return t.apply(this,arguments)})}]),e}();e.IFramyChild=h,Object.defineProperty(e,"__esModule",{value:!0})}));
